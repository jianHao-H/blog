---
title: CTFshow sql注入-万能密码,虚拟表绕过
# swiper_index: 10
categories:
    -网络安全
tags:
  - sql注入
  - 代码审计
  - ctfshow
abbrlink: 22275
date: 2022-12-04 22:40:00
updated: 2022-12-04 22:40:00
---

# ctfshow web9
<img  src="https://source.bugcarrot.top/articles/cfsweb/web9-10/1.png" align='left'/>

php5中的md5函数有一个可选参数，如果开发者写查询数据库函数时使用了这个参数，或者在数据存储时是md5后的字符串形式存储，都有可能产生这个漏洞

语法：
```
md5(string, raw)
```

| 参数 | 描述     |
| -------- | -------- |
| string        | 必需，规定要计算的字符串 |
| raw        | 可选，规定十六进制或二进制输出格式： <br >1. TRUE - 原始的16字符二进制格式 <br >2. FALSE - 默认，32字符十六进制数|

{% tip info %}
md5看似是非常强加密措施，但是一旦没有返回我们常见的16进制数，返回了二进制原始输出格式，在浏览器编码的作用下就会编码成为奇怪的字符串（对于二进制一般都会编码）。
我们使用md5碰撞，一旦在这些奇怪的字符串中碰撞出了可以进行SQL注入的特殊字符串，那么就可以越过登录了

129581926211651571912466741651878684928
ffifdyop
{% endtip %}

<img  src="https://source.bugcarrot.top/articles/cfsweb/web9-10/3.png"/>

# ctfshow web10

下载index.phps审计代码
<img  src="https://source.bugcarrot.top/articles/cfsweb/web9-10/4.png"/>

```
$regex = "/(select|from|where|join|sleep|and|\s|union|,)/i";
```

将关键字替换成空，可以双写绕过，但后续还存在验证
<img  src="https://source.bugcarrot.top/articles/cfsweb/web9-10/5.png" align='left'/>
使得查询出来的值要与POST的值相同

这里使用**with rollup** 绕过
可知groud by 语句可以将结果集中的数据行根据选择列的值进行逻辑分组排序
**with rollup** （group by 后可以跟with rollup，表示在进行分组统计的基础上再次进行汇总统计）

实例：
<img src="https://source.bugcarrot.top/articles/cfsweb/web9-10/6.png" align='center'/>

<img src="https://source.bugcarrot.top/articles/cfsweb/web9-10/7.png" align='left' width=50%/>

<img src="https://source.bugcarrot.top/articles/cfsweb/web9-10/8.png" align='left' width=50%/>


可知使用with rollup后会在分组统计的基础上再次进行汇总统计，结果将多出一行，password为null，count（*）为统计和使用万能用户名 a' or true 使sql成立绕过用户名后，后台的sql会查询出所有的用户信息，然后依次判断查询处的用户名对应的密码和我们输入的密码是否相同，这时使用with roolup，由于with roolup不会对group by分组的密码字段进行统计，所以返回的结果最后一行用NULL来填充，这样一来返回的结果中就存在一个NULL，只要登陆框中的密码也为NULL，便 （NULL == NULL）登陆成功

{% tip info %}
Payload: a'or true group by pwd with rollup#
{% endtip %}

<img src="https://source.bugcarrot.top/articles/cfsweb/web9-10/9.png" align='left'%/>
<img src="https://source.bugcarrot.top/articles/cfsweb/web9-10/10.png" align='left'/>



