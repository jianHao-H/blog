---
title: ctfshow - 文件下载+伪造session
# swiper_index: 1
categories:
    -网络安全
tags:
  - session伪造
  - flask
  - ctfshow
abbrlink: 22275
date: 2022-11-28 21:30:00
updated: 2022-11-28 21:30:00
---

# ctfshow菜狗杯 web4 抽老婆

首先打开页面
下载图片，极有可能存在下载漏洞，burp抓包看看（趁机屯一波图片）
![code](https://source.bugcarrot.top/articles/cfscgb/clp-1.png)

随便输入一个文件名?file=index.html发现报错文件不存在，此时有两个问题，一个是绝对路径位置，另一个是不清楚目录结构，不知道flag可能会在什么地方，往下看，发现是flask，可能会存在模板注入，尝试{1 * 2}，并没有返回想要的结果，那极有可能是让我们下载某个文件了，那都有什么文件呢，发现 /app/app.py 下载这个试试，可知目前的目录是/app/static/img/，看看一下服务端有没有过滤 ../ 这个东西
![code](https://source.bugcarrot.top/articles/cfscgb/clp-2.png)

成功下载
![code](https://source.bugcarrot.top/articles/cfscgb/clp-3.png)

审计源码
![code](https://source.bugcarrot.top/articles/cfscgb/clp-4.png)

可以知道，当访问 /secret_path_U_never_know 这个路径并且session的isadmin为true的时候会返回flag
但是我们之前下载图片访问的路径后已经将admin变成了false
所以现在需要伪造session，因为flask框架的特性，伪造session需要secret_key，而上面已经给出了，直接找一个flask伪造的脚本
![code](https://source.bugcarrot.top/articles/cfscgb/clp-5.png)

然后上burp修改session，即可
![code](https://source.bugcarrot.top/articles/cfscgb/clp-6.png)


